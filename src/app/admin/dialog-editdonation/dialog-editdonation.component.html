<div class="loading-shade" *ngIf="isLoading">
  <div
    class="col s12"
    style="
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 10px;
    "
  >
    <span>
      <mat-spinner [diameter]="32" mode="indeterminate"></mat-spinner>
    </span>
  </div>
</div>
<form [formGroup]="editrsvp" (ngSubmit)="onSubmit()">
  <h1 mat-dialog-title class="mattitle">
    {{ addScreen ? "Add Guest" : "Edit Guest" }}
  </h1>
  <div mat-dialog-content class="matbody">
    <mat-tab-group style="height: 500px" [(selectedIndex)]="selectedTab">
      <mat-tab label="User Attendance">
        <div class="row" style="margin-top: 20px; width: 95%">
          <div class="col-12">
            <mat-form-field style="width: 100%">
              <input
                matInput
                placeholder="Name*"
                type="text"
                maxlength="50"
                required
                formControlName="name"
              />
              <mat-error
                *ngIf="
                  editrsvp.controls.name.hasError('letterAndNumberSpaceOnly')
                "
                >Only alphanumeric is allowed.</mat-error
              >
            </mat-form-field>
          </div>
          <div class="col-12">
            <mat-form-field style="width: 100%">
              <input
                matInput
                placeholder="Staff ID*"
                type="text"
                maxlength="50"
                required
                formControlName="staffId"
              />
              <mat-error
                *ngIf="
                  editrsvp.controls.staffId.hasError('letterAndNumberSpaceOnly')
                "
                >Only alphanumeric is allowed.</mat-error
              >
            </mat-form-field>
          </div>
          <div class="col-12">
            <mat-form-field style="width: 100%">
              <input
                matInput
                placeholder="Email*"
                type="text"
                maxlength="50"
                required
                formControlName="email"
              />
              <mat-error *ngIf="editrsvp.controls.email.hasError('email')"
                >Only Email Format is allowed.
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-12">
            <mat-form-field style="width: 100%">
              <mat-label>Attended*</mat-label>
              <mat-select formControlName="userAttend">
                <mat-option value="1">Yes</mat-option>
                <mat-option value="0">No</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-12">
            <mat-form-field style="width: 100%">
              <mat-label>Acc Person*</mat-label>
              <input
                matInput
                placeholder="Acc Person*"
                type="number"
                min="0"
                required
                formControlName="guestAvailable"
              />
              <mat-error
                *ngIf="editrsvp.controls.guestAvailable.hasError('numberOnly')"
                >Only number is allowed.</mat-error
              >
            </mat-form-field>
          </div>
          <div class="col-12">
            <mat-form-field style="width: 100%">
              <mat-label>Acc Attended*</mat-label>
              <input
                matInput
                placeholder="Acc Attended*"
                type="number"
                min="0"
                required
                formControlName="guestAttend"
              />
              <mat-error
                *ngIf="editrsvp.controls.guestAttend.hasError('numberOnly')"
                >Only number is allowed.</mat-error
              >
            </mat-form-field>
          </div>
        </div>
      </mat-tab>
      <mat-tab label="Booth Chances">
        <table class="table" style="margin-top: 20px; text-align: center">
          <tr>
            <td>Booth Number</td>
            <td>Total Chances</td>
            <td>Chances Left</td>
          </tr>
          <tr *ngFor="let userBooth of user.userBooths; let i = index">
            <td>
              {{ userBooth.boothNum }}
            </td>
            <td>
              <input
                type="number"
                class="form-control text-center"
                style="width: 150px; display: inherit"
                min="0"
                (change)="
                  changeChancesTotal(userBooth.boothNum, $event.target.value)
                "
                value="{{ userBooth.chancesTotal }}"
              />
            </td>
            <td>
              <input
                type="number"
                class="form-control text-center"
                style="width: 150px; display: inherit"
                min="0"
                (change)="
                  changeChancesLeft(userBooth.boothNum, $event.target.value)
                "
                value="{{ userBooth.chancesLeft }}"
              />
            </td>
          </tr>
        </table>
      </mat-tab>
      <mat-tab label="Booth Activties">
        <table class="table" style="margin-top: 20px; text-align: center">
          <tr>
            <td>Play Date</td>
            <td>Booth Number</td>
            <td>Chance Left</td>
            <td>Status</td>
          </tr>
          <tr *ngFor="let boothActivity of boothActivities; let i = index">
            <td>
              {{
                boothActivity.createdDate
                  ? (boothActivity.createdDate._seconds * 1000
                    | date: "dd-MMM-yyyy hh:mma")
                  : ""
              }}
            </td>
            <td>
              {{ boothActivity.boothNum }}
            </td>
            <td>
              {{ boothActivity.chancesLeft }}
            </td>
            <td>
              <select
                (change)="changeBooth(boothActivity.id, $event.target.value)"
                class="custom-select"
                [ngStyle]="{
                  'background-color':
                    boothActivity.status == '1' ? '#C1E1C1' : '#F597B2'
                }"
                [value]="boothActivity.status"
              >
                <option value="0">Cancelled</option>
                <option value="1">Completed</option>
              </select>
            </td>
          </tr>
        </table>
      </mat-tab>
    </mat-tab-group>
  </div>
  <mat-dialog-actions align="center">
    <button type="submit" class="btn btn-info mr-1">
      {{ addScreen ? "Add" : "Update" }}
    </button>
    <button mat-dialog-close type="button" class="btn cancel-button">
      Close
    </button>
  </mat-dialog-actions>
</form>
